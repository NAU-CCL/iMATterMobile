{"ast":null,"code":"var _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { UserSubmissionsService } from '../../../../services/userSubmissions/user-submissions.service';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ToastController } from '@ionic/angular';\nimport { Storage } from '@ionic/storage';\nimport * as firebase from 'firebase/app';\nlet SuggestionsPage = class SuggestionsPage {\n  constructor(afs, activatedRoute, userSubmissionService, toastCtrl, router, storage) {\n    this.afs = afs;\n    this.activatedRoute = activatedRoute;\n    this.userSubmissionService = userSubmissionService;\n    this.toastCtrl = toastCtrl;\n    this.router = router;\n    this.storage = storage;\n    this.locationSuggestion = {\n      name: '',\n      address: '',\n      reason: '',\n      username: '',\n      userID: '',\n      timestamp: '',\n      type: '',\n      viewed: false\n    };\n  }\n\n  ngOnInit() {\n    this.storage.get('authenticated').then(val => {\n      if (val === 'false') {\n        this.router.navigate(['/login/']);\n      }\n    });\n  }\n\n  submitLocationSuggestion() {\n    this.storage.get('userCode').then(val => {\n      if (val) {\n        const ref = this.afs.firestore.collection('users').where('code', '==', val);\n        ref.get().then(result => {\n          result.forEach(doc => {\n            this.locationSuggestion.userID = val;\n            this.locationSuggestion.timestamp = firebase.firestore.FieldValue.serverTimestamp();\n            this.locationSuggestion.username = doc.get('username');\n            this.locationSuggestion.type = 'Location Suggestion';\n            this.userSubmissionService.addLocationSuggestion(this.locationSuggestion).then(() => {\n              this.router.navigateByUrl('/tabs/more/resources');\n              this.showToast('Suggestion sent');\n              this.locationSuggestion.name = '';\n              this.locationSuggestion.address = '';\n              this.locationSuggestion.reason = '';\n            }, err => {\n              this.showToast('There was a problem sending the suggestion');\n            });\n          });\n        });\n      }\n    });\n  }\n\n  showToast(msg) {\n    this.toastCtrl.create({\n      message: msg,\n      duration: 2000\n    }).then(toast => toast.present());\n  }\n\n};\nSuggestionsPage = __decorate([Component({\n  selector: 'app-suggestions',\n  templateUrl: './suggestions.page.html',\n  styleUrls: ['./suggestions.page.scss']\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof AngularFirestore !== \"undefined\" && AngularFirestore) === \"function\" ? _a : Object, ActivatedRoute, UserSubmissionsService, ToastController, Router, Storage])], SuggestionsPage);\nexport { SuggestionsPage };","map":null,"metadata":{},"sourceType":"module"}