{"ast":null,"code":"var _a;\n\nimport { __decorate, __metadata } from \"tslib\";\nimport { Component } from '@angular/core';\nimport { UserSubmissionsService } from '../../../services/userSubmissions/user-submissions.service';\nimport { AngularFirestore } from '@angular/fire/firestore';\nimport { ActivatedRoute, Router } from '@angular/router';\nimport { ToastController } from '@ionic/angular';\nimport { Storage } from '@ionic/storage';\nimport * as firebase from 'firebase/app';\nimport { Device } from '@ionic-native/device/ngx';\nimport { FormBuilder, Validators } from '@angular/forms';\nlet ReportPage = class ReportPage {\n  constructor(afs, activatedRoute, userSubmissionService, toastCtrl, router, storage, formBuilder, device) {\n    this.afs = afs;\n    this.activatedRoute = activatedRoute;\n    this.userSubmissionService = userSubmissionService;\n    this.toastCtrl = toastCtrl;\n    this.router = router;\n    this.storage = storage;\n    this.formBuilder = formBuilder;\n    this.device = device;\n    this.report = {\n      title: '',\n      description: '',\n      username: '',\n      userID: '',\n      timestamp: '',\n      type: '',\n      operatingSys: '',\n      version: '',\n      viewed: false\n    };\n    this.reportForm = this.formBuilder.group({\n      subject: ['', Validators.compose([Validators.required, Validators.minLength(1)])],\n      description: ['', Validators.compose([Validators.required, Validators.minLength(1)])]\n    });\n  }\n\n  ngOnInit() {\n    this.storage.get('authenticated').then(val => {\n      if (val === 'false') {\n        this.router.navigate(['/login/']);\n      }\n    });\n  }\n\n  submitSubmission(submissionForm) {\n    this.storage.get('platform').then(val => {\n      if (val) {\n        this.report.operatingSys = val + ' ' + this.device.model;\n      }\n    });\n    this.storage.get('userCode').then(val => {\n      if (val) {\n        const ref = this.afs.firestore.collection('users').where('code', '==', val);\n        ref.get().then(result => {\n          result.forEach(doc => {\n            this.report.title = submissionForm.value.subject;\n            this.report.description = submissionForm.value.description;\n            this.report.userID = val;\n            this.report.timestamp = firebase.firestore.FieldValue.serverTimestamp();\n            this.report.username = doc.get('username');\n            this.report.type = 'Problem';\n            this.report.version = this.device.version;\n            this.userSubmissionService.addReport(this.report).then(() => {\n              this.router.navigateByUrl('/tabs/more');\n              this.showToast('Report sent');\n              this.report.title = '';\n              this.report.description = '';\n            }, err => {\n              this.showToast('There was a problem sending your problem report');\n            });\n          });\n        });\n      }\n    });\n  }\n\n  showToast(msg) {\n    this.toastCtrl.create({\n      message: msg,\n      duration: 2000\n    }).then(toast => toast.present());\n  }\n\n};\nReportPage = __decorate([Component({\n  selector: 'app-report',\n  templateUrl: './report.page.html',\n  styleUrls: ['./report.page.scss']\n}), __metadata(\"design:paramtypes\", [typeof (_a = typeof AngularFirestore !== \"undefined\" && AngularFirestore) === \"function\" ? _a : Object, ActivatedRoute, UserSubmissionsService, ToastController, Router, Storage, FormBuilder, Device])], ReportPage);\nexport { ReportPage };","map":null,"metadata":{},"sourceType":"module"}